"use strict";
function _defineProperty(a, b, c) {
  return (
    b in a
      ? Object.defineProperty(a, b, {
          value: c,
          enumerable: !0,
          configurable: !0,
          writable: !0
        })
      : (a[b] = c),
    a
  );
}
define(["jquery", "https://cdn.staticfile.org/vue/2.6.10/vue.min.js"], function(a, b) {
  var f = {};
  return (
    (f.init = function(g, h) {
      var j;
      b.component("item-list", {
        template:
          '<div style="padding: 1em;"><div class="item-list-selected aligen-center"  v-if="o.selected.length > 0"><slot name="selected" v-for="(item,index) in o.selected" :item="item" :index="index + 1"></slot><div class="selected-loading" title="\u52A0\u8F7D\u4E2D..." v-if="o.init_ids.length > 0"><i class="fa fa-spinner fa-pulse"></i></div></div><div v-else><slot name="empty-selected"></slot></div><div class="tools"><div class="input-group" style="width:20em;" v-show="search_box && show_list"><input type="text" class="form-control" style="border-radius: 6px 0 0 6px;"  placeholder="\u8F93\u5165\u641C\u7D22\u5185\u5BB9..." v-model="o.filter.keywords"><span class="input-group-addon" style="cursor:pointer;" @click="toggleSearchBox()" title="\u5173\u95ED\u641C\u7D22\u6846"><i class="fa fa-ban"></i></span> </div><div class="btn-toolbar" role="toolbar"><div class="btn-group" role="group" v-show="show_list || o.selected.length == 0"><button type="button"  :class="{\'btn btn-default\': true, \'btn-revert\': o.filter.keywords}" :title="\'\u641C\u7D22 \' + o.filter.keywords" @click="toggleSearchBox()" v-show="!search_box"><i :class="[\'fa\', o.loading?\'fa-spinner fa-spin\':\'fa-search\', o.filter.keywords? \'fa-flip-horizontal\':\'\']"></i></button><button type="button" class="btn btn-default"  title="\u5168\u90E8\u9009\u62E9" @click="addAll()" :disabled="no_selected"><i :class="[\'fa\', o.loading ? \'fa-spinner fa-spin\':\'fa-chevron-up\', no_selected?\'disabled\':\'\']"></i></button><button type="button" class="btn btn-default"  title="\u5168\u90E8\u53D6\u6D88" @click="removeAll()" :disabled="o.selected.length == 0"><i :class="[\'fa\', o.loading ? \'fa-spinner fa-spin\' : \'fa-chevron-down\', o.selected.length == 0 ? \'disabled\':\'\']"></i> </button><template v-if="o.totalpage > 1"><button type="button" class="btn btn-default" title="\u4E0A\u4E00\u9875" @click="prePage()" :disabled="o.page <= 1"><i :class="[\'fa\', o.loading?\'fa-spinner fa-spin\':\'fa-angle-double-left\', o.page > 1 ? \'\':\'disabled\']"></i></button><button type="button" class="btn btn-default" disabled><span v-text="o.page"></span>/<span v-text="o.totalpage"></span></button><button type="button" class="btn btn-default" title="\u4E0B\u4E00\u9875" @click="nextPage()" :disabled="o.page >= o.totalpage"><i :class="[\'fa\', o.loading?\'fa-spinner fa-spin\':\'fa-angle-double-right\', o.page < o.totalpage ? \'\':\'disabled\']"></i></button></template></div><div class="btn-group" role="group" v-show="o.selected.length > 0"><button type="button" class="btn btn-default" :title="show_list?\'\u9690\u85CF\u53EF\u9009\u5217\u8868\':\'\u663E\u793A\u53EF\u9009\u5217\u8868\'" @click="toggleList()"><i :class="[\'fa\', show_list ? \'fa-eye-slash\': \'fa-eye\']"></i></button></div></div></div><div  v-show="show_list || o.selected.length == 0"><div :class="[\'item-list\', o.list.length > 20 ? \'space-between\' : \'aligen-center\']"><slot name="list" v-for="item in o.list" :item="item"></slot></div><div class="btn-more" v-if="more_objs"><i class="fa fa-angle-double-down" title="\u663E\u793A\u66F4\u591A..." @click="changePageSize()" v-if="!o.loading"></i></div></div><div v-show="o.list.length === 0"><slot name="empty-list"></slot></div></div>',
        props: { obj: { type: Object, require: !0 } },
        data: function data() {
          return { o: this.obj, search_box: !1, show_list: !0 };
        },
        watch: ((j = {}),
        _defineProperty(j, "o.filter.keywords", function oFilterKeywords() {
          this.getData(1);
        }),
        _defineProperty(j, "o.selected", function oSelected(k) {
          0 === k.length && (this.show_list = !0);
        }),
        j),
        computed: {
          more_objs: function more_objs() {
            return this.o.list.length < this.o.total;
          },
          no_selected: function no_selected() {
            return (
              -1 ==
              this.o.list.findIndex(function(k) {
                return !k.selected;
              })
            );
          }
        },
        created: function created() {
          var k = this;
          this.getData(this.o.page, function() {
            k.initData();
          });
        },
        methods: {
          generateSerial: function generateSerial() {
            this.serial = Math.random();
          },
          toggleSearchBox: function toggleSearchBox() {
            this.search_box = !this.search_box;
          },
          toggleList: function toggleList() {
            this.show_list = !this.show_list;
          },
          changePageSize: function changePageSize() {
            (this.o.filter.pagesize *= 2), this.getData(1);
          },
          addAll: function addAll() {
            this.$emit("add-all", this.o);
          },
          removeAll: function removeAll() {
            this.$emit("remove-all", this.o);
          },
          prePage: function prePage() {
            1 < this.o.page && this.getData(this.o.page - 1);
          },
          nextPage: function nextPage() {
            this.getData(this.o.page + 1);
          },
          replaceIfExists: function replaceIfExists(k) {
            return function(l) {
              var m = k.findIndex(function(n) {
                return n.id == l.id;
              });
              return -1 != m && (b.set(k, m, l), !0);
            };
          },
          getIdsData: function getIdsData(k) {
            var l = this;
            return a.post(l.o.api_url, { ids: k, pagesize: k.length }, function(
              m
            ) {
              m &&
                m.status &&
                m.data &&
                (m.data.list || []).forEach(function(n) {
                  (n.selected = !0), l.o.selected.push(n);
                });
            });
          },
          initData: function initData() {
            var n = this,
              k = this;
            if (k.o.init_ids) {
              var l = [],
                m = [];
              k.o.init_ids.forEach(function(o) {
                var p = k.o.list.find(function(q) {
                  return q.id == o;
                });
                p
                  ? ((p.selected = !0), k.o.selected.push(p))
                  : (m.push(o),
                    50 <= m.length && (l.push(n.getIdsData(m)), (m = [])));
              }),
                0 < m.length && (l.push(this.getIdsData(m)), (m = [])),
                a.when.apply(a, l).done(function() {
                  k.o.init_ids = [];
                });
            }
          },
          getData: function getData(k, l) {
            this.generateSerial();
            var m = this.fetchData(
              this.o,
              k,
              this.replaceIfExists(this.o.selected)
            );
            "function" == typeof l && a.when(m).done(l);
          },
          fetchData: function fetchData(k, l, m) {
            var n = this;
            n.search_box || (k.filter.keywords = "");
            var o = {
              page: l,
              pagesize: k.filter.pagesize,
              keywords: k.filter.keywords,
              serial: n.serial
            };
            return (
              (k.loading = !0),
              a.post(k.api_url, o, function(p) {
                if (p && p.status && p.data) {
                  if (p.data.serial && p.data.serial != n.serial) return;
                  b.set(k, "page", p.data.page || 0),
                    b.set(k, "total", p.data.total || 0),
                    b.set(k, "totalpage", p.data.totalpage || 0),
                    b.set(k, "list", p.data.list || []),
                    "function" == typeof m &&
                      k.list.forEach(function(q) {
                        b.set(q, "selected", m(q));
                      });
                }
                k.loading = !1;
              })
            );
          }
        }
      }),
        b.component("assign-ctrl", {
          template:
            '<div id="app" v-cloak><slot></slot><div class="panel panel-default"><div class="panel-heading"><div class="btn-group btn-group-justified" role="group"><div class="btn-group" role="group" v-if="funcs.all.enabled"><button type="button" :class="[\'btn\', all_sel ? \'btn-success\':\'btn-default\']" @click="all_sel=true">\u5168\u90E8</button></div><div class="btn-group" role="group"  v-if="funcs.agents.enabled"><button type="button" :class="[\'btn\', agents_sel ? \'btn-success\':\'btn-default\']" @click="agents_sel=!agents_sel"><i class="fa fa-spinner fa-pulse" title="\u52A0\u8F7D\u4E2D..." v-if="selectedLoading(\'agents\')"></i> \u4EE3\u7406\u5546&nbsp; <span class="selected-count" v-show="agents_selected_count > 0 && agents_sel">{{agents_selected_count}}</span></button></div><div class="btn-group" role="group"  v-if="funcs.groups.enabled"><button type="button" :class="[\'btn\', groups_sel ? \'btn-success\':\'btn-default\']" @click="groups_sel=!groups_sel"><i class="fa fa-spinner fa-pulse" title="\u52A0\u8F7D\u4E2D..." v-if="selectedLoading(\'groups\')"></i> \u5206\u7EC4&nbsp;<span class="selected-count" v-show="groups_selected_count > 0 && groups_sel">{{groups_selected_count}}</span></button></div> <div class="btn-group" role="group"  v-if="funcs.tags.enabled"><button type="button" :class="[\'btn\', tags_sel ? \'btn-success\':\'btn-default\']" @click="tags_sel=!tags_sel"><i class="fa fa-spinner fa-pulse" title="\u52A0\u8F7D\u4E2D..." v-if="selectedLoading(\'tags\')"></i> \u6807\u7B7E&nbsp;<span class="selected-count" v-show="tags_selected_count > 0 && tags_sel">{{tags_selected_count}}</span></button></div><div class="btn-group" role="group"  v-if="funcs.devices.enabled"><button type="button" :class="[\'btn\', devices_sel ? \'btn-success\':\'btn-default\']" @click="devices_sel=!devices_sel"><i class="fa fa-spinner fa-pulse" title="\u52A0\u8F7D\u4E2D..." v-if="selectedLoading(\'devices\')"></i> \u8BBE\u5907&nbsp;<span class="selected-count" v-show="devices_selected_count > 0 && devices_sel">{{devices_selected_count}}</span></button></div></div></div> <div class="panel-body" v-if="all_sel"> <div class="jumbotron"><h1>\u5206\u914D\u8BBE\u5907<small v-text="desc"></small></h1><p>\u8981\u5206\u914D\u5230\u5168\u90E8\u8BBE\u5907\u8BF7\u6309\u786E\u5B9A\u6309\u94AE\uFF0C\u8981\u6E05\u9664\u6240\u6709\u5DF2\u9009\u8BBE\u5907\u8BF7\u6309\u6E05\u7A7A\u6309\u94AE\u3002<br>\u8BF7\u9009\u62E9\uFF1F</p><p><button type="button" class="btn btn-primary btn-outline" @click="btnOk()">\u786E\u5B9A</button>&nbsp;<button type="button" class="btn btn-danger" @click="btnCleanAll()">\u6E05\u7A7A</button>&nbsp;<a class="btn btn-default" :href="back_url" role="button">\u8FD4\u56DE</a></p></div></div><div class="panel-body bordered" v-show="agents_sel"><item-list :obj="container[\'agents\']" @add-all="addAll" @remove-all="removeAll"><div class="empty-list" slot="empty-selected">                    <span>\u8BF7\u9009\u62E9\u4EE3\u7406\u5546</span>                </div>                <div class="empty-list" slot="empty-list">                    <span>\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u4EE3\u7406\u5546\uFF0C\u53EA\u652F\u6301\u67E5\u627E\u624B\u673A\u53F7\u7801\u548C\u5FAE\u4FE1\u6635\u79F0\uFF01</span>                </div>                                <div slot="selected" slot-scope="props" class="agent item simple"                @click="removeItem(container[\'agents\'], props.item)"><img :src="props.item.avatar" :title="agentNameOf(props.item)"></div><div slot="list" slot-scope="props" :class="{\'item agent\': true, \'selected\': props.item.selected}" :style="{backgroundColor: props.item.selected ? \'\' : props.item.agentData.level.clr}" :title="props.item.nickname" :key="props.item.id"  @click="toggleItem(container[\'agents\'], props.item)"><img :src="props.item.avatar"><div><span class="name" v-text="agentNameOf(props.item)"></span>                        <span class="total_tips">({{props.item.total}}\u53F0)</span></div></div></item-list></div><div class="panel-body bordered" v-show="groups_sel"><item-list :obj="container[\'groups\']"  @add-all="addAll" @remove-all="removeAll"><div class="empty-list" slot="empty-selected"><span>\u8BF7\u9009\u62E9\u5206\u7EC4</span></div><div class="empty-list" slot="empty-list"><span>\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u5206\u7EC4</span></div><div slot="selected" slot-scope="props" class="item group simple" :style="{backgroundColor:props.item.clr}" :key="props.item.id" @click="removeItem(container[\'groups\'], props.item)"><span v-text="props.item.title" class="name"></span></div><div  slot="list" slot-scope="props" :class="{\'item group\': true, \'selected\': props.item.selected}" :style="{backgroundColor:props.item.selected?\'\':props.item.clr}" :key="props.item.id" @click="toggleItem(container[\'groups\'], props.item)"><span class="name" :title="props.item.tag">{{props.item.title}}({{props.item.total}}\u53F0)</span>                </div>            </item-list></div><div class="panel-body bordered"  v-show="tags_sel"><item-list :obj="container[\'tags\']"  @add-all="addAll" @remove-all="removeAll"><div class="empty-list" slot="empty-selected"><span>\u8BF7\u9009\u62E9\u6807\u7B7E</span></div><div class="empty-list" slot="empty-list"><span>\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u6807\u7B7E</span></div><div slot="selected" slot-scope="props" class="item tag simple" @click="removeItem(container[\'tags\'], props.item)"><span v-text="props.item.title" class="name"></span></div><div  slot="list" slot-scope="props" :key="props.item.id" :class="{\'item tag\': true, \'selected\': props.item.selected}" @click="toggleItem(container[\'tags\'], props.item)"><span class="name" :title="props.item.tag">{{props.item.title}}({{props.item.count}}\u53F0)</span></div></item-list></div> <div class="panel-body bordered"  v-show="devices_sel"><item-list :obj="container[\'devices\']"  @add-all="addAll" @remove-all="removeAll"><div class="empty-list" slot="empty-selected"><span>\u8BF7\u9009\u62E9\u8BBE\u5907</span></div><div class="empty-list" slot="empty-list"><span>\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u8BBE\u5907</span></div><div slot="selected" slot-scope="props" class="item device simple" @click="removeItem(container[\'devices\'], props.item)"><span v-text="props.item.name" class="name"></span></div><div  slot="list" slot-scope="props" :key="props.item.id" :class="{\'item device\': true, \'selected\': props.item.selected}" @click="toggleItem(container[\'devices\'], props.item)"><span v-text="props.item.name" class="name" :title="props.item.agent ? \'\u6240\u5C5E\u4EE3\u7406\u5546\uFF1A\' + props.item.agent:\'\'"></span></div></item-list></div><div class="panel-body" v-show="!all_sel"><div class="pull-right"><button type="button" class="btn btn-primary" @click="btnOk()">\u786E\u5B9A</button><a class="btn btn-default" :href="back_url" role="button">\u8FD4\u56DE</a></div></div></div></div>',
          data: function data() {
            return {
              funcs: {
                all: { show: !0, enabled: !0 },
                agents: { show: !1, enabled: !1 },
                groups: { show: !1, enabled: !1 },
                tags: { show: !1, enabled: !1 },
                devices: { show: !1, enabled: !1 }
              },
              multi: !1,
              desc: "",
              container: {},
              back_url: ""
            };
          },
          watch: {
            funcs: {
              handler: function handler(k) {
                k.agents.show ||
                  k.groups.show ||
                  k.tags.show ||
                  k.devices.show ||
                  (k.all.show = !0);
              },
              deep: !0
            }
          },
          computed: {
            all_sel: {
              get: function get() {
                return this.funcs.all.enabled && this.funcs.all.show;
              },
              set: function set(k) {
                var l = this;
                this.funcs.all.enabled &&
                  (k &&
                    [
                      "agents_sel",
                      "groups_sel",
                      "tags_sel",
                      "devices_sel"
                    ].forEach(function(m) {
                      b.set(l, m, !1);
                    }),
                  (this.funcs.all.show = k));
              }
            },
            agents_sel: {
              get: function get() {
                return this.funcs.agents.enabled && this.funcs.agents.show;
              },
              set: function set(k) {
                this.funcs.agents.enabled &&
                  (k &&
                    ((this.all_sel = !1),
                    !this.multi &&
                      ((this.groups_sel = !1),
                      (this.tags_sel = !1),
                      (this.devices_sel = !1))),
                  (this.funcs.agents.show = k));
              }
            },
            groups_sel: {
              get: function get() {
                return this.funcs.groups.enabled && this.funcs.groups.show;
              },
              set: function set(k) {
                this.funcs.groups.enabled &&
                  (k &&
                    ((this.all_sel = !1),
                    !this.multi &&
                      ((this.agents_sel = !1),
                      (this.tags_sel = !1),
                      (this.devices_sel = !1))),
                  (this.funcs.groups.show = k));
              }
            },
            tags_sel: {
              get: function get() {
                return this.funcs.tags.enabled && this.funcs.tags.show;
              },
              set: function set(k) {
                this.funcs.tags.enabled &&
                  (k &&
                    ((this.all_sel = !1),
                    !this.multi &&
                      ((this.agents_sel = !1),
                      (this.groups_sel = !1),
                      (this.devices_sel = !1))),
                  (this.funcs.tags.show = k));
              }
            },
            devices_sel: {
              get: function get() {
                return this.funcs.devices.enabled && this.funcs.devices.show;
              },
              set: function set(k) {
                this.funcs.devices.enabled &&
                  (k &&
                    ((this.all_sel = !1),
                    !this.multi &&
                      ((this.agents_sel = !1),
                      (this.groups_sel = !1),
                      (this.tags_sel = !1))),
                  (this.funcs.devices.show = k));
              }
            },
            more_agents: function more_agents() {
              return (
                this.container.agents.list.length < this.container.agents.total
              );
            },
            no_selected_agents: function no_selected_agents() {
              return (
                -1 ==
                this.container.agents.list.findIndex(function(k) {
                  return !k.selected;
                })
              );
            },
            agents_selected_total: function agents_selected_total() {
              var k = 0;
              return (
                this.container.agents.selected.forEach(function(l) {
                  k += l.total;
                }),
                k
              );
            },
            agents_selected_count: function agents_selected_count() {
              return this.container.agents.selected.length;
            },
            groups_selected_count: function groups_selected_count() {
              return this.container.groups.selected.length;
            },
            tags_selected_count: function tags_selected_count() {
              return this.container.tags.selected.length;
            },
            devices_selected_count: function devices_selected_count() {
              return this.container.devices.selected.length;
            }
          },
          created: function created() {
            this.init(g);
          },
          methods: {
            selectedLoading: function selectedLoading(k) {
              return (
                k && this.container[k] && 0 < this.container[k].init_ids.length
              );
            },
            assigned_desc: function assigned_desc(k) {
              return a.isEmptyObject(k) ||
              (void 0 !== k.all && !k.all) ||
              "0" === k.all ||
              "false" === k.all
                ? ((this.desc =
                    "\uFF08\u672A\u5206\u914D\u5230\u4EFB\u4F55\u8BBE\u5907\uFF09"),
                  this.desc)
                : k && k.all
                  ? ((this.desc =
                      "\uFF08\u5DF2\u5206\u914D\u5230\u5168\u90E8\u8BBE\u5907\uFF09"),
                    this.desc)
                  : ((this.desc =
                      "\uFF08\u5DF2\u5206\u914D\u5230\u6307\u5B9A\u8BBE\u5907\uFF09"),
                    this.desc);
            },
            init: function init(k) {
              var m = this;
              this.assigned_desc(k.data);
              var l = k.data || {};
              k.multi && (this.multi = !0),
                (k.funcs || ["agents", "groups", "tags", "devices"])
                  .forEach(function(n) {
                    b.set(m.container, n, {
                      api_url: k[n],
                      loading: !1,
                      total: 0,
                      page: 1,
                      totalpage: 0,
                      filter: { page: 0, pagesize: 50, keywords: "" },
                      init_ids: l[n] || [],
                      list: [],
                      selected: []
                    }),
                      (m.funcs[n].enabled = !0),
                      k.data[n] &&
                        Array.isArray(k.data[n]) &&
                        0 < k.data[n].length &&
                        ((m.funcs[n].show = !0), (m.all_sel = !1));
                  }),
                (this.back_url = k.back_url);
            },
            agentNameOf: function agentNameOf(k) {
              return k.agentData && k.agentData.name
                ? k.agentData.name
                : k.nickname || "\u672A\u77E5";
            },
            addAll: function addAll(k) {
              var l = this;
              k.list.forEach(function(m) {
                m.selected || l.toggleItem(k, m);
              });
            },
            removeAllUnselected: function removeAllUnselected() {
              for (var k in this.container)
                !1 == this.funcs[k].show && this.removeAll(this.container[k]);
            },
            removeAll: function removeAll(k) {
              this;
              k.selected.forEach(function(m) {
                m.selected = !1;
              }),
                (k.selected = []);
            },
            removeItem: function removeItem(k, l) {
              var m = k.selected.findIndex(function(n) {
                return n.id == l.id;
              });
              -1 != m &&
                ((k.selected[m].selected = !1), k.selected.splice(m, 1));
            },
            toggleItem: function toggleItem(k, l) {
              if (l.selected) this.removeItem(k, l);
              else {
                b.set(l, "selected", !0);
                var m = k.selected.findIndex(function(n) {
                  return n.id == l.id;
                });
                -1 == m && k.selected.push(l);
              }
            },
            btnOk: function btnOk() {
              var l = this,
                k = {};
              this.all_sel
                ? (k.all = 1)
                : ["agents", "groups", "tags", "devices"].forEach(function(m) {
                    l.funcs[m].enabled &&
                      l.funcs[m].show &&
                      (0 < l.container[m].selected.length &&
                        void 0 == k[m] &&
                        (k[m] = []),
                      l.container[m].selected.forEach(function(n) {
                        k[m].push(n.id);
                      }));
                  }),
                this.saveData(k);
            },
            btnCleanAll: function btnCleanAll() {
              this.saveData({ all: 0 });
            },
            saveData: function saveData(k) {
              this.removeAllUnselected(),
                "function" == typeof h && h(k) && this.assigned_desc(k);
            }
          }
        }),
        new b({ el: "#app", data: {} });
    }),
    f
  );
});
