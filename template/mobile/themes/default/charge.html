<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>{$tpl['balance']['title']}充值</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<style type="text/css">
			html,
			body {
				position: relative;
				height: 100%;
			}
			
			body {
				background: #fff;
				font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
				font-size: 14px;
				color: #000;
				margin: 0;
				padding: 0;
				background-image: url(img/bg.png);
				background-repeat: no-repeat;
				background-size: 100% 100%;
				-moz-background-size: 100% 100%;
			}
			
			.scroll-view {
				width: 100%;
				height: 100%;
				overflow-y: scroll;
			}
			
			.main-view {
				width: 100%;
				min-height: 100%;
				display: flex;
				flex-direction: column;
				position: relative;
			}
			
			.header {
				width: 100%;
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: space-between;
				margin-top: 15px;
			}
			
			.title {
				margin-left: 15px;
				color: #000000;
				font-size: 16px;
			}
			
			.white-view {
				margin: 10px 10px 0;
				background-color: #fff;
				display: flex;
				flex-direction: column;
				padding-bottom: 15px;
			}
			
			.coin-list {
				width: 90%;
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				align-items: center;
				justify-content: space-around;
			}
			
			.coin-item {
				width: 30%;
				padding: 10px 0;
				margin-top: 15px;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				border: 1px solid #259B24;
				border-radius: 5px;
			}
			
			.unselected {
				background-color: #fff;
				color: #259B24;
			}
			
			.selected {
				background-color: #259B24;
				color: #fff;
			}
			
			.other-num {
				align-self: flex-end;
				margin: 10px 20px 0 0;
				color: #2249D4;
				font-size: 12px;
			}
			
			.coin-input {
				width: 85%;
				height: 30px;
				margin-top: 5px;
				font-size: 14px;
				padding: 0 5px;
				display: none;
			}
			
			.coupon-list {
				margin: 0 15px;
				display: flex;
				flex-direction: column;
			}
			
			.coupon-item {
				color: #000;
				font-size: 14px;
				margin-top: 5px;
			}
			
			.disabled {
				color: #ccc;
			}
			
			.activity-item {
				color: #000;
				font-size: 14px;
				margin-top: 5px;
			}
			
			.activity-num {
				color: #f00;
			}
			
			.pay-btn {
			    width: 90%;
				margin: 10px 10px;
				padding: 10px 0;
				font-size: 16px;
				color: #fff;
				background-color: #259B24;
				display: flex;
				align-items: center;
				justify-content: center;
				border-radius: 5px;
			}
			
			.copyright {
				width: 100%;
				color: #fff;
				font-size: 14px;
				font-family: "rage italic";
				position: absolute;
				left: 0;
				bottom: 10px;
				text-align: center;
			}
            #myv {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                top: 0;
                z-index: -99;
            }
            #myv canvas {
                position: absolute;
                top:0;
            }
		</style>
	</head>
	<body>
	    <div id="myv">
            <div id="vout">
                <canvas width="100%" height="100%"></canvas>
            </div>
        </div>
		<div class="scroll-view">
			<div class="main-view">
				<div class="white-view" style="align-items: center;">
					<div class="header">
						<div class="title">充值的{$tpl['balance']['title']}数量</div>
						<div style="margin-right: 15px;color: #ccc;font-size: 12px;">*{$tpl['balance']['title']}用来购买商品</div>
					</div>
					<div class="coin-list" id="amount-list">
					    {loop $tpl['amount']['list'] $index $item}
						<div class="coin-item unselected" data-amount="{$item['amount']}" data-price="{$item['price']}">
							<div><span style="font-size: 18px;font-weight:bold;">{$item['amount']}</span>{$tpl['balance']['unit']}</div>
							<div style="font-size: 12px;">售价￥{$item['price_formatted']}元</div>
						</div>
						{/loop}
					</div>
				</div>
				
				<div class="white-view">
				    {if $tpl['coupon']['list']}
					<div class="header">
						<div class="title">可使用的代金券</div>
					</div>
					<div class="coupon-list">
					    {loop $tpl['coupon']['list'] $index $item}
					    <div class="radio">
    						<label class="coupon-item disabled" data-xrequire="{$item['xrequire']}">
    						    <input name="coupon" type="radio" value="{$item['uid']}" disabled/>
    						    {$item['memo']}
    						 </label>
						 </div>
						{/loop}
					</div>
					{/if}
					<div class="pay-btn">微信支付</div>
				</div>
				<div class="copyright">{$copyrights}</div>
			</div>
		</div>
    	{$tpl['js']['code']}

		<script type="text/javascript">
            $(function(){
                $('#amount-list').on('tap', '.coin-item', function(e){
                    $(this).siblings('div').removeClass('selected').addClass('unselected');
                    $(this).removeClass('unselected').addClass('selected');
                    
                    var price = parseInt($(this).data('price'), 10);
                    $('.coupon-list .coupon-item').each(function(){
                        var self = $(this);
                        var xrequire = parseInt(self.data('xrequire'), 10);
                        if (price >= xrequire) {
                            self.removeClass('disabled');
                            self.find('input').attr({
                                'checked': true,
                                'disabled': false,
                            });
                        }else{
                            self.addClass('disabled');
                            self.find('input').attr({'disabled': true, 'checked': false});
                        }
                    })
                });
                
                $(".pay-btn").click(function(){
                    var amount = $("#amount-list .selected").data('amount') || 0;
                    var coupon = $("input[name=coupon]:checked").val() || '';
                    if(amount > 0) {
                        zovye_fn.charge(amount, coupon);
                    }
                });
            });
		</script>
		<script src="{MODULE_URL}static/js/vector.js"></script>
		<script>
		    var victor = new Victor("myv", "vout");
            victor(["#ac0908", "#cd5726"]).set();
		</script>
	</body>
</html>