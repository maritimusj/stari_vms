<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>{$tpl['page']['title']}</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<style type="text/css">
			html,
			body {
				position: relative;
				height: 100%;
			}
			
			body {
				background: #fff;
				font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
				font-size: 14px;
				color: #000;
				margin: 0;
				padding: 0;
			}
			
			.main-view {
				width: 100%;
				height: 100%;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				background-size: 100% 100%;
				-moz-background-size: 100% 100%;
			}
			
			.row-view {
				width: 100%;
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: center;
			}
			
			.user-view {
				margin-left: 50px;
				display: flex;
				flex-direction: column;
				align-items: center;
			}
			
			.avatar {
				width: 80px;
				height: 80px;
				border-radius: 50%;
				border: 2px solid #fff;
			}
			
			.nickname {
				color: #fff;
				font-size: 14px;
				margin-top: 5px;
			}
			
			.qrcode-view {
				width: 50px;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
			
			.qrcode-icon {
				width: 30px;
				height: 30px;
			}
			
			.qrcode-desc {
				color: #fff;
				font-size: 12px;
				font-weight: 300;
				margin-top: 3px;
			}
			
			.coin-view {
			    margin-left: 55px;
				color: #fff;
				font-size: 20px;
				display: flex;
				align-items: center;
			}
			
			.coin-num {
				color: #ecf0a7;
				font-size: 30px;
			}
			
			.coin-charge-btn {
				padding: 10px 16px;
				border-radius: 4px;
				background-color: #259B24;
				color: #fff;
				font-size: 18px;
				display: flex;
				align-items: center;
				justify-content: center;
				margin-top: 20px;
				text-decoration: none;
			}
			
			.coin-desc {
				color: #d4d4d4;
				font-size: 10px;
				margin-top: 5px;
			}
			
			.banner-view {
				width: 90%;
				height: 35px;
				background-color: rgba(0, 0, 0, 0.1);
				margin-top: 10px;
				display: flex;
				flex-direction: row;
				align-items: center;
			}
			
			.banner-icon {
				width: 25px;
				height: 25px;
				margin-left: 5px;
			}
			
			ul,
			li {
				margin: 0 0 0 10px;
				padding: 0;
			}
			
			.banner {
				flex-grow: 1;
				height: 35px;
				color: #fff;
				font-size: 14px;
				overflow: hidden;
			}

			.banner ul li {
				list-style: none;
				line-height: 35px;
				/*以下为了单行显示，超出隐藏*/
				display: block;
				white-space: nowrap;
				text-overflow: ellipsis;
				overflow: hidden;
			}
			
			.draw-btn {
				width: 80%;
				/*height: 60px;*/
				padding: 12px 0;
				background-color: #fff;
				margin-top: 15px;
				border-radius: 5px;
				display: flex;
				flex-direction: row;
				align-items: center;
				justify-content: center;
				text-decoration: none;
				color: #101010;
				font-family: 'rage italic';
			}
			
			.copyright {
				width: 100%;
				color: #fff;
				font-size: 14px;
				font-family: "rage italic";
				position: absolute;
				left: 0;
				bottom: 10px;
				text-align: center;
			}
            #myv {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                top: 0;
                z-index: -99;
            }
            #myv canvas {
                position: absolute;
                top:0;
            }
			.mask {
				width: 100%;
				height: 100%;
				position: fixed;
				left: 0;
				top: 0;
				background-color: rgba(0, 0, 0, 0.8);
				z-index: 999;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
			}
			
			.prize-bg {
				width: 100%;
				padding: 110px 0;
				background-image: url({MODULE_URL}static/img/light.png);
				background-repeat: no-repeat;
				background-size: 100% 100%;
				-moz-background-size: 100% 100%;
				display: flex;
				align-items: center;
				justify-content: center;
				position: relative;
			}
			
			.prize-view {
				width: 80%;
				background-color: #fff;
				border-radius: 20px;
				display: flex;
				flex-direction: column;
				align-items: center;
				overflow: hidden;
				animation: prize-show .7s ease 0s normal both;
			}
			
			.prize-img {
				width: 90%;
				position: absolute;
				top: 0;
				left: 5%;
				z-index: -99;
				animation: prize-show .7s ease 0s normal both;
			}
			
			.prize-title {
				font-size: 20px;
				color: #DEAE57;
				margin: 20px;
				text-align: center;
			}
			
			.prize-info {
				width: 90%;
				display: flex;
				flex-direction: row;
				align-items: center;
			}
			
			.prize-icon {
				width: 50px;
				height: 50px;
				margin-left: 10px;
			}
			
			.prize-name {
				margin-left: 10px;
				color: #333;
				font-size: 15px;
				font-weight: 400;
				flex-grow: 1;
			}
			
			.use-btn {
				min-width: 70px;
				height: 25px;
				background-color: #DEAE57;
				color: #fff;
				font-size: 12px;
				border-radius: 12.5px;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			
			.postscript {
				color: #f00;
				font-size: 13px;
				margin-top: 10px;
			}
			
			.share-btn {
				width: 100%;
				min-height: 40px;
				background-color: #DEAE57;
				color: #fff;
				font-size: 15px;
				display: flex;
				align-items: center;
				justify-content: center;
				margin-top: 10px;
			}
			
			.close {
				width: 25px;
				height: 25px;
				position: absolute;
				top: 20px;
				right: 20px;
			}
			
			@keyframes prize-show {
				0% {
					transform: scale(0);
				}
				100% {
					transform: scale(1);
				}
			}
			
			.coin-increase {
				color: #ecf0a7;
				font-size: 30px;
				animation: coin-increase-show 2s ease 0s normal both;
			}
			
			@keyframes coin-increase-show {
				0% {
					opacity: 0;
				}
				50% {
					opacity: 1;
					transform: translateY(0);
				}
				100% {
					opacity: 0;
					transform: translateY(-20px);
				}
			}

		</style>
	</head>
	<body>
	   <div id="myv">
            <div id="vout">
                <canvas width="100%" height="100%"></canvas>
            </div>
        </div>
		<div class="main-view">
			<div class="row-view" style="margin-top: -5rem;">
				<div class="user-view">
					<img class="avatar" src="{$tpl['user']['avatar']}" />
					<span class="nickname">{$tpl['user']['nickname']}，您好！</span>
				</div>
				<div class="qrcode-view" onClick="zovye_fn.scan()">
					<img class="qrcode-icon" src="{MODULE_URL}static/img/qrcode_icon.png" />
					<span class="qrcode-desc">扫码领取</span>
				</div>
			</div>
			<div class="row-view" style="margin-top: 40px;">
				<div class="coin-view">{$tpl['balance']['title']}：<span class="coin-num">{$tpl['user']['balance']}</span>
					<div style="min-width: 50px;margin-left: 5px;" id="coin-increase-div">
						<span class="coin-increase" style="display: none;"></span>
					</div>
				</div>
			</div>
			<div class="coin-desc">{$tpl['balance']['title']}用于购买商品!</div>
			<div class="coin-charge-btn" onClick="zovye_fn.charge()">立即充值</div>
			{if $tpl['prize']['enabled'] }
			{if $tpl['prize']['news']}
			<div class="banner-view">
				<div>
					<img class="banner-icon" src="{MODULE_URL}static/img/banner_icon.png" />
				</div>
				<div class="banner">
					<ul>
					    {loop $tpl['prize']['news'] $index $item}
						<li>{$item}</li>
						{/loop}
					</ul>
				</div>
			</div>
			{/if}
			<div class="draw-btn" onClick="drawClick()">
				<img style="width: 25px;height: 25px;" src="{MODULE_URL}static/img/fire_icon.png" />
				<div style="font-size: 20px;">每日抽奖A</div>
				<div style="font-size: 10px;margin-top: -20px;margin-left: 5px;">免费得{$tpl['balance']['title']}</div>
			</div>
			<div style="color: #fff;text-decoration: none;margin-top: 10px;" onClick="zovye_fn.myPrizes()">我的奖品</div>
			{/if}
			<div class="copyright">{$tpl['site']['copyrights']}</div>
		</div>
		<div class="mask" style="display: none;" onClick="maskClose()">
			<div class="prize-bg" id="prize">
				<div class="prize-view">
					<div class="prize-title"></div>
					<div class="prize-info">
						<div>
							<img class="prize-icon" src="" />
						</div>
						<span class="prize-name"></span>
						<div class="use-btn">立即查看</div>
					</div>
					<div class="share-btn"></div>
				</div>
				<img class="prize-img" src="{MODULE_URL}static/img/prize.png" />
			</div>
			<img class="close" src="{MODULE_URL}static/img/mask_close.png" />
		</div>

		{$tpl['js']['code']}

		{if $tpl['prize']['enabled']}
		<script type="text/javascript">
			function drawClick() {
			    zovye_fn.getPrize(function(res){
			        if(res) {
			            if (res.status) {
    			            var prize = $('#prize');
    			            
    			            prize.find('.prize-title').text(res.data.msg);
    			            prize.find('img.prize-icon').attr('src', res.data.img);
    			            prize.find('.prize-name').text(res.data.title);
    			            prize.find('.share-btn').text(res.data.desc);
    			            prize.find('.use-btn').data('link', res.data.link);
    
            				var mask = document.querySelector(".mask");
            				mask.style.display = "flex";
            				
            				var change = res.data && res.data.change && res.data.balance ? res.data.change : 0;
        				    $('#coin-increase-div').data('change', change);
        				    $('#coin-increase-div').data('balance',  res.data.balance);			                
			            }else{
			                if(res.data && res.data.msg) {
			                    alert(res.data.msg);
			                }
			            }
			        }
			    })
			}

			$(function() {
				// 调用 公告滚动函数
				setInterval("noticeUp('.banner ul','-35px',1000)", 2000);
				
    			$(".prize-view").click(function(event) {
    				event.stopPropagation();
    			})

				$('.use-btn').click(function(e){
				   e.stopPropagation();
				   var url = $(this).data('link');
				   location.href = url;
				})
			});

			function maskClose() {
				var mask = document.querySelector(".mask");
				mask.style.display = "none";
				
			    var el = $('#coin-increase-div');
			    var o = el.data('change');
			    if (o > 0) {
			        el.find('.coin-increase').text('+' + o);
    				var coinIncrease = document.querySelector(".coin-increase");
    				coinIncrease.style.display = "block";
    				setTimeout(function() {
    					coinIncrease.style.display = "none";
    				}, 2000);
    				setTimeout(function() {
    					updateCoinNum(el.data('balance'));
    				}, 1000);			        
			    }
			}
			
			function updateCoinNum(n) {
				var coinNum = document.querySelector(".coin-num");
				coinNum.innerHTML = n;
			}
            function noticeUp(obj, top, time) {
            	$(obj).animate({
            		marginTop: top
            	}, time, function() {
            		$(this).css({
            			marginTop: "0"
            		}).find(":first").appendTo(this);
            	})
            }

		{/if}
		</script>
		<script src="{MODULE_URL}static/js/vector.js"></script>
		<script>
		    var victor = new Victor("myv", "vout");
            victor(["#ac0908", "#cd5726"]).set();
		</script>
	</body>
</html>