{template 'common/header'}
{php \zovye\url(true, 'static/css/common.css?v=20230710');}
{php \zovye\url(true, 'static/css/device.css?v=20230721');}
<style>
    #devicelist .log .app.online .mcb {
        border-color: #FF9800;
    }
    #devicelist .log .app .mcb.online {
        background-color: #FFC107;
    }
</style>
<div id="appx" v-cloak>
    <div class="init-loading" v-if="device.list === undefined">
        <i class="fa fa-spinner fa-spin"></i>&nbsp;加载中...
    </div>
    <div class="panel panel-default" v-else>
        <div class="heading">
            <span class="operate">
                <a href="{php echo $this->createWebUrl('device', ['op'=>'edit', 'model'=>'normal']);}">
                    <img src="{MODULE_URL}static/img/machine.svg" class="icon" title="添加新设备">
                </a>
                {if \zovye\App::isChargingDeviceEnabled()}
                <a href="{php echo $this->createWebUrl('device', ['op'=>'edit', 'model'=>'charging']);}">
                    <img src="{MODULE_URL}static/img/charging.svg" class="icon" title="添加充电桩">
                </a>
                {/if}
                {if \zovye\App::isFuelingDeviceEnabled()}
                <a href="{php echo $this->createWebUrl('device', ['op'=>'edit', 'model'=>'fueling']);}">
                    <img src="{MODULE_URL}static/img/fueling.svg" class="icon" title="添加尿素加注设备">
                </a>
                {/if}
                {if \zovye\App::isVDeviceSupported()}
                <a href="{php echo $this->createWebUrl('device', ['op'=>'edit', 'model'=>'vd']);}">
                    <img src="{MODULE_URL}static/img/vdevice.svg" class="icon" title="添加虚拟设备">
                </a>
                {/if}
                {if \zovye\App::isBluetoothDeviceSupported()}
                <a href="{php echo $this->createWebUrl('device', ['op'=>'edit', 'model'=>'bluetooth']);}">
                    <img src="{MODULE_URL}static/img/bluetooth.svg" class="icon" title="添加蓝牙设备">
                </a>
                <a href="{php echo $this->createWebUrl('device', ['op'=>'import_bluetooth_device_upload']);}">
                    <img src="{MODULE_URL}static/img/upload_bluetooth.svg" class="icon" title="导入蓝牙设备">
                </a>
                {/if}
                <a href="{php echo $this->createWebUrl('device', ['op'=>'new_group']);}">
                    <img src="{MODULE_URL}static/img/group.svg" class="icon" title="分组管理">
                </a>
                <a href="{php echo $this->createWebUrl('device', ['op'=>'report_list']);}">
                    <img src="{MODULE_URL}static/img/malfunction.svg" class="icon" title="故障报告列表">
                </a>
                <img src="{MODULE_URL}static/img/reload.svg" class="icon" title="通知所有设备刷新配置？"  onclick="api.refreshAll();">
                <a href="{php echo $this->createWebUrl('device', ['op'=>'clean_error']);}">
                    <img src="{MODULE_URL}static/img/clear.svg" class="icon" title="清除所有设备错误代码">
                </a>
                {if $upload}
                <img src="{MODULE_URL}static/img/upload_device.svg" class="icon" title="上传设备信息"  onclick="api.uploadInfo();">
                {/if}
                <img src="{MODULE_URL}static/img/sim.svg" class="icon" title="导出SIM卡信息"  onclick="api.exportSIM();">
            </span>
        </div>
        <div class="panel-body">
            <div id="search-bar" v-show="expendStatus==0" @click="expendStatus=1">
                <div class="text-input">
                    <span>根据条件搜索设备 ...</span>
                    <span class="button"><i class="fa fa-search"></i>&nbsp;搜索</span>
                </div>
            </div>
            <div id="search-form" v-show="expendStatus==1">
                <form>
                    <div class="form-group">
                        <label class="col-md-2 control-label">所属代理商</label>
                        <div class="col-md-5">
                            <select style="width:100%;" v-model="device.filter.agent">
                                <option v-for="agent in agent.list" :key="agent.id" :value="agent.id">
                                    {{agent.name + (agent.mobile ? '，手机号码：' + agent.mobile : '')}}
                                </option>                            
                                <option value="" :selected="device.filter.agent === ''">&lt;不限&gt;</option>
                                <option value="-1" :selected="device.filter.agent === '-1'">&lt;平台&gt;</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="请输入手机号码或者名称查找..." v-model.trim="agent.keyword">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-default" type="button" title="搜索代理商" @click.prevent="searchAgent">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label">型号</label>
                        <div class="col-md-5">
                            <select style="width:100%;" v-model="device.filter.type">
                                <option v-for="type in deviceTypes.list" :key="type.id" :value="type.id">
                                    {{type.title + '（' + type.lanes_total + '货道）'}}
                                </option>   
                                <option value="" :selected="device.filter.type === ''">&lt;不限&gt;</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="请输入关键字查找型号..." v-model.trim="deviceTypes.keyword">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-default" type="button" title="搜索型号" @click.prevent="searchDeviceTypes">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label">分组</label>
                        <div class="col-md-5">
                            <select style="width:100%;" v-model="device.filter.group">
                                <option v-for="group in group.list" :key="group.id" :value="group.id">
                                    {{group.title + (group.agent ? '（代理商：' + group.agent.name + '）': '')}}
                                </option>
                                <option value="" :selected="device.filter.group === ''">&lt;不限&gt;</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="请输入关键字查找分组..." v-model.trim="group.keyword">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-default" type="button" title="搜索分组" @click.prevent="searchGroup">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label operate">标签
                            <template v-if="tags.selectedIds.length > 0">
                                <span class="badge">{{tags.selectedIds.length}}</span>
                                <i class="fa fa-ban" title="清除所有标签" @click="cleanTagsClicked()"></i>                                
                            </template>
                        </label>
                        <div class="col-md-5" id="tagslist">
                            <span class="tag-page-btn" title="上一页"
                            v-if="tags.totalpage > 1"
                            :disabled="tags.page <= 1 || tags.loading" @click.prevent="tagsPrePage">
                                <i class="fa fa-angle-double-left"></i>
                            </span>                            
                            <div class="tag" v-for="tag in tags.list" :key="tag.id"
                            :style="{'background-color': tag.selected?'#009688':'#9E9E9E'}"
                            @click.prevent="selectTag(tag)">
                                <span>{{tag.title}}</span>
                            </div>
                            <span class="tag-page-btn" title="下一页"
                            v-if="tags.totalpage > 1"
                            :disabled="tags.page >= tags.totalpage || tags.loading" @click.prevent="tagsNextPage">
                                <i class="fa fa-angle-double-right"></i>
                            </span>   
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" placeholder="请输入关键字查找标签..." v-model.trim="tags.keyword">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-default" type="button" title="搜索标签" @click.prevent="searchTags">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label">状态</label>
                        <div class="col-md-10" id="other">
                            <label>
                                <input type="checkbox" v-model="device.filter.online">
                                在线
                            </label>                              
                            <label>
                                <input type="checkbox" v-model="device.filter.offline">
                                离线
                            </label>                        
                            <label>
                                <input type="checkbox" v-model="device.filter.low">
                                缺货
                            </label>
                            <label>
                                <input type="checkbox" v-model="device.filter.error">
                                故障
                            </label>
                            <label>
                                <input type="checkbox" v-model="device.filter.maintenance">
                                已停用
                            </label>
                            {if \zovye\settings('device.lac.enabled')}
                            <label>
                                <input type="checkbox" v-model="device.filter.lac">
                                位置已变动
                            </label>
                            {/if}
                            <label>
                                <input type="checkbox" v-model="device.filter.lost">
                                超过{$lost_offset_day}天未上线
                            </label>
                            <label>
                                <input type="checkbox" v-model="device.filter.no_order">
                                超过{$issuing_offset_day}天未出货
                            </label>                            
                            <label>
                                <input type="checkbox" v-model="device.filter.unbind">
                                未绑定App
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-2 control-label">关键字</label>
                        <div class="col-md-8">
                            <input  class="form-control" type="text" style="width: 100%;" v-model.trim="device.filter.keywords" autofocus="autofocus" ref="defaultInput">
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-primary" @click.prevent="searchButtonClicked"><i class="fa fa-search"></i>&nbsp;搜索</button>
                            <button class="btn btn-default btn-close" title="清除搜索" @click.prevent="searchCancelButtonClicked"><i class="fa fa-ban" style="color: gray;"></i></button>
                        </div>
                    </div>
                </form>
            </div>
            <table class="table" id="devicelist">
                <thead v-show="device.list !== undefined">
                    <tr>
                        <th class="operate">
                            <i :class="{'fa': true, 'fa-check-square': isAllSelected, 'fa-square-o': !isAllSelected}" title="全部" v-if="showSelectInputCtrl" @click="selectAll"></i> 
                            <template v-else>#</template>
                        </th>
                        <th class="operate" style="position: relative;">
                            <template v-if="showSelectInputCtrl && canDownload">
                                <i class="fa fa-download" title="下载选中的设备二维码" @click="downloadQRCode"></i><span class="badge" style="position: absolute;">{{selectedInputCtrl.length}}</span>
                            </template>
                            <i :class="{'fa':true, 'fa-sign-out': showSelectInputCtrl, 'fa-square-o':!showSelectInputCtrl}" title="选择" @click="showSelectInputCtrl=!showSelectInputCtrl" v-else></i>
                        </th>
                        <th>                    
                            <div data-orderby="imei" @click="getListBy('imei')" :class="['fa', sort.by === 'imei' ? sort.dir: '']">设备名称</div>
                        </th>
                        <th>
                            <div data-orderby="agentId" @click="getListBy('agent_id')" :class="['fa', sort.by === 'agent_id' ? sort.dir: '']">所属代理商</div>
                        </th>
                        <th style="min-width:3em;">
                        </th>
                        <th>
                        <div>出货数量</div>
                            <div><span>今日</span>
                            /
                            <span>本月</span></div>
                        </th>
                        <th>
                            <div data-orderby="groupId"  @click="getListBy('group_id')" :class="['fa', sort.by === 'group_id' ? sort.dir: '']">分组</div>
                        </th>
                        <th style="width: 60px;">
                            标签
                        </th>
                        <th class="center">
                            <div data-orderby="online" @click="getListBy('mcb_online')" :class="['fa', sort.by === 'mcb_online' ? sort.dir: '']">状态</div>
                        </th>
                        <th style="width: 165px;">
                            响应时间
                        </th>
                        <th>
                            <div data-orderby="createtime" @click="getListBy('createtime')" :class="['fa', sort.by === 'createtime' ? sort.dir: '']">创建时间</div>
                        </th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(o,index) in device.list" :key="o.id" :data-fetchid="o.id" :class="o.model">
                        <td class="operate">
                            <template v-if="showSelectInputCtrl">
                                <input type="checkbox" id="downloadQRCode" :value="o.id" v-model="selectedInputCtrl">                                
                            </template>
                            <template v-else>
                                <template v-if="o.lockedTime">
                                    <i class="fa fa-lock" :title="'锁定时间：' + o.lockedTime" data-op="unlock" :data-index="index + 1"></i>
                                </template>
                                <template v-else>
                                    <template v-if="o.s1">
                                        <span class="operate">
                                            <i class="fa fa-map-marker" title="设备位置已变动" data-op="confirmLAC" :data-index="index + 1"></i>
                                        </span>                                    
                                    </template>
                                    <template v-else>
                                        {{index + 1}}
                                    </template>
                                </template>
                            </template>
                        </td>
                        <td class="device-qrcode">
                            <div class="imei">
                                <img src="{MODULE_URL}static/img/qrcode.svg" class="qrcode" v-if="o.activeQrcode">
                                <i class="fa fa-qrcode" v-else></i>
                                <div class="zovye_qrcode" :data-url="o.getUrl" title="点击复制链接">
                                    <img :src="o.qrcode" />
                                    <template v-for="url in o.qrcodes" v-if="o.qrcodes">
                                        <img :src="url" />
                                    </template>  
                                </div>

                            </div>
                        </td>
                        <td>
                            <div class="devicename">
                                {{o.name}}
                                <template v-if="o.isCharging">
                                    <sup class="charging" title="充电桩">
                                        <img src="{MODULE_URL}static/img/charging.svg" class="icon">
                                    </sup>
                                </template>
                                <template v-if="o.isFueling">
                                    <sup class="charging" title="尿素加注设备">
                                        <img src="{MODULE_URL}static/img/fueling.svg" class="icon">
                                    </sup>
                                </template>
                                <template v-if="o.isVD">
                                    <sup class="vdevice" title="虚拟设备">
                                        <img src="{MODULE_URL}static/img/vdevice.svg" class="icon">
                                    </sup>
                                </template>  
                                <template v-if="o.isBluetooth">
                                    <sup class="bluetooth" :title="'蓝牙设备 ' + o.BUID">
                                        <img src="{MODULE_URL}static/img/bluetooth.svg" class="icon">
                                    </sup>
                                </template>
                                <span class="operate">
                                    <template v-if="o.isDown">
                                        <img src="{MODULE_URL}static/img/wrench.svg" data-op="setNormal" title="设备维护中，点击取消" class="icon">
                                    </template>
                                    <template v-if="o.schedule && o.schedule > 0">
                                        <img src="{MODULE_URL}static/img/schedule.svg" 
                                        data-op="getScheduleTaskList"
                                        :title="o.schedule + '个定时出货任务'"
                                        class="icon">
                                    </template>
                                </span>
                                <div class="address" v-if="o.address && (o.address.web || o.address.agent)">
                                    <div class="li" v-if="o.address.web">
                                        <span class="web title">后台位置</span>
                                        <span class="addr">{{o.address.web}}</span>
                                    </div>
                                    <div class="li" v-if="o.address.agent">
                                        <span class="agent title">代理商位置</span>
                                        <span class="addr">{{o.address.agent}}</span>
                                    </div>                                    
                                </div>
                            </div>
                        </td>
                        <td>
                            <template v-if="typeof o.agent === 'string'">
                                <div class="agent">                                    
                                    <div class="profile loading">
                                        <img/>
                                        <div class="nickname">{{o.agent}}</div>
                                    </div>
                                </div>
                            </template>
                            <template v-if="typeof o.agent === 'object'">
                                <div class="agent" @click="agentClicked(o.agent)">
                                    <div class="profile" 
                                    :style="{backgroundColor:o.agent.level.clr, cursor:device.filter.agent === o.agent.id?'default':'pointer'}"
                                    :title="device.filter.agent === o.agent.id?'':'点击查看' + o.agent.name + '的所有设备'">
                                        <img :src="o.agent.avatar">
                                        <div class="nickname">{{o.agent.name}}</div>
                                    </div>
                                </div>                              
                            </template>
                            <div class="noagent" v-if="!o.agent">&lt;平台&gt;</div>  
                        </td>
                        <td>
                            <div class="operate">
                                <div class="getway" v-if="o.model === 'normal' || o.model === 'vd'">
                                    <i class="fa fa-map-marker" :style="{'color': o.gettype && o.gettype.location ? '#607D8B':'#eee'}" :title="o.gettype&&o.gettype.location?'需要定位':'未开启定位'"></i>
                                    <i class="fa fa-street-view" :style="{'color': o.gettype && o.gettype.free ? '#607D8B':'#eee'}" :title="o.gettype&&o.gettype.free?'关注公众号领取' + (o.gettype.freeLimitsReached?'(已限额)':''):'不允许关注领取'"></i>
                                    <i class="fa fa-shopping-cart" :style="{'color': o.gettype && o.gettype.price ? '#607D8B':'#eee'}" :title="o.gettype&&o.gettype.price?'可支付' + o.gettype.price + '元购买':'不允许支付购买'"></i>
                                </div>
                            </div>
                        </td>
                        <td class="sat operate">
                            <template v-if ="o.total && o.total == 'n/a'">
                                <span>-</span>
                            </template>
                            <template v-else>
                                <span :class="{today:o.total&&o.total.today>0,zero:o.total&&o.total.today === 0}" :title="o.total&&o.total.today > 0 ?'查看今日统计':'今日暂无订单'">
                                    <i class="fa fa-spinner fa-spin"  title="加载中..." v-if="o.total === undefined"></i>
                                    <span :data-op="o.total&&o.total.today > 0 ? 'showDayStats':''" v-else>{{o.total.today}}</span>
                                </span>
                                /
                                <span :class="{month:o.total&&o.total.month > 0,zero:o.total&&o.total.month === 0}" :title="o.total&&o.total.month > 0 ? '查看月统计':'本月暂无订单'">
                                    <i class="fa fa-spinner fa-spin" title="加载中..." v-if="o.total === undefined"></i>
                                    <span :data-op="o.total&&o.total.month > 0 ? 'showMonthStats':''" v-else>{{o.total.month}}</span>
                                </span>
                                &nbsp;<i class="fa fa-list" data-op="orders" title="点击查看这台设备的历史订单..." :style="{'visibility':o.total?'visible':'hidden'}" v-if="o.total !== undefined"></i>
                            </template>
                        </td>
                        <td class="group">
                            <template v-if="o.group">   
                                <span class="groupname" 
                                :title="device.filter.group === o.group.id ? '':'点击查看该分组所有设备'" 
                                :style="{'background-color':o.group.clr, 'cursor': device.filter.group === o.group.id ? 'default':'pointer'}"
                                @click.prevent="deviceGroupClicked(o.group, o.agent)"
                                >{{o.group.title}}</span>                        
                            </template>
                            <span class="nogroup" v-else>&lt;无分组&gt;</span>
                        </td>
                        <td class="tags-list">
                            <div class="tags" v-if="o.tags && o.tags.length>0">
                                <span class="tag first-tag" @click="tagClicked(o.tags[0])">{{o.tags[0].title}}</span>
                                <div class="tagslist tags" v-if="o.tags.length > 1">
                                    <span class="tag" v-for="tag in o.tags"  @click="tagClicked(tag)">{{tag.title}}</span>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="status" :class="{log: o.logging}">
                                <i class="fa fa-clock-o loading" title="加载中..." style="color:#ddd;" v-if="!o.status"></i>
                                <i class="fa fa-spinner fa-pulse" title="加载中..." style="color:#9e9e9e;" v-if="o.loading"></i>
                                <div :class="{'app': true, 'loading': !o.status, 'none': o.status.app === null, 'online': o.status && o.status.app === true, 'offline': o.status && o.status.app === false, 'down': o.isDown}" v-if="o.status && !o.loading">
                                    <div @click.self="refreshStatus(o)" :class="{'mcb': true, 'loading': !o.status, 'none': o.status.mcb === null, 'online': o.status && o.status.mcb === true, 'offline': o.status && o.status.mcb === false}" tabindex="0" role="button">
                                        <div class="devcie-detail">
                                            <div class="detail-seg">
                                                <div><span class="title" v-text="o.isCharging ? '设备编号：' : 'IMEI：'"></span><span>{{o.IMEI}}</span></div> 
                                                <div>
                                                    <span class="title">ICCID：</span>
                                                    <span>{{o.ICCID ? o.ICCID : 'n/a'}}
                                                        {if $gate['build'] >= '20211204'}
                                                        <span class="card_status" v-if="o.ICCID" :data-uid="o.ICCID">
                                                            <i class="fa fa-info-circle" title="查询流量卡状态" data-op="viewCardStatus"></i>
                                                        </span>
                                                        {/if}
                                                    </span>
                                                </div>
                                                <template v-if="o.charging">
                                                    <div><span class="title">桩类型：</span><span>{{o.charging.cft}}</span></div>
                                                    <div><span class="title">充电枪数量：</span><span>{{o.charging.chargerNum}}</span></div>
                                                    <div><span class="title">通信协议版本：</span><span>{{o.charging.protocolVersion}}</span></div>
                                                    <div><span class="title">固件版本：</span><span>{{o.charging.firmwareVersion}}</span></div>
                                                    <div><span class="title">网络类型：</span><span>{{o.charging.network}}</span></div>
                                                    <div><span class="title">运营商：</span><span>{{o.charging.carrier}}</span></div>
                                                </template>
                                                <template v-if="o.appId">
                                                    <div><span class="title">AppID：</span><span>{{o.appId}}</span></div>
                                                    <div><span class="title">AppVersion：</span><span>{{o.appVersion ? o.appVersion : 'n/a'}}</span></div>
                                                </template>

                                                <template v-if="o.v0_status && o.v0_status.sig !== undefined && o.v0_status.sig != -1">
                                                    <div>
                                                        <span class="title">信号强度：</span>
                                                        <div class="bar sig">
                                                            <div :style="{minWidth:'2em', width: o.v0_status.sig + '%'}">{{o.v0_status.sig + '%'}}</div>
                                                        </div>
                                                    </div>
                                                </template>
                                                <template v-if="o.v0_status && o.v0_status.qoe != undefined && o.v0_status.qoe != -1">
                                                    <div>
                                                        <span class="title">电池电量：</span>
                                                        <div class="bar qoe">
                                                            <div :style="{minWidth:'2em',width: o.v0_status.qoe + '%'}">{{o.v0_status.qoe + '%'}}</div>
                                                        </div>
                                                    </div>
                                                </template>
                                                <template v-if="o.v0_status && o.v0_status.voltage">
                                                    <div>
                                                        <span class="title">工作电压：</span><span>{{o.v0_status.voltage}}v</span>
                                                    </div>
                                                </template>
                                                <template v-if="o.v0_status && o.v0_status.count">
                                                    <div>
                                                        <span class="title">累计出货：</span><span>{{o.v0_status.count}}</span>
                                                    </div>
                                                </template>
                                                <template v-if="o.v0_status && o.v0_status.error">
                                                    <div>
                                                        <span class="title">错误代码：</span><span  class="error">{{o.v0_status.error}}</span>
                                                    </div>
                                                </template>
                                                
                                            </div>
                                            <template v-if="o.doorNum && o.doorNum > 0">
                                            <div class="detail-seg">
                                                <div class="door">
                                                    <span class="title">门锁：</span>
                                                    <span>
                                                        <i v-for="i in o.doorNum" v-text="i" @click="openDoor(o.id, i)" title="点击发送开锁指令"></i>
                                                    </span>
                                                </div>
                                            </div>
                                            </template>
                                            <div class="detail-seg" v-if="(o.lastError && o.lastError.errno) || o.firstMsgTotal || o.lastPing || o.lastOnline">
                                                <div v-if="o.lastPing">
                                                    <span class="title">最近心跳：</span>
                                                    <span>{{o.lastPing}}</span>
                                                </div>
                                                <div v-if="o.lastOnlineIp">
                                                    <span class="title">最后上线IP：</span>
                                                    <span>{{o.lastOnlineIp}}</span>
                                                </div>                                                
                                                <div v-if="o.lastOnline">
                                                    <span class="title">最后上线：</span>
                                                    <span>{{o.lastOnline}}</span>
                                                </div>
                                                <div v-if="o.lastError && o.lastError.errno">
                                                    <span class="title">最近错误：</span>
                                                    <span class="error">{{o.lastError.message}}</span>
                                                </div>
                                                <div v-if="o.firstMsgTotal">
                                                    <span class="title">今日重启：</span>
                                                    <span>{{o.firstMsgTotal}}次</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div :id="'chart_' + o.id" style="width: 160px;height: 60px;">
                            </div>
                        </td>
                        <td>
                            {{o.createtime}}
                        </td>
                        <td class="operate">
                            <div class="btn-group">
                                <a class="btn btn-default" href="#" :title="o.isCharging ? '充电枪' : o.isFueling ? '加注枪' : '货道'" data-op="deviceTestAll">
                                    <i :class="{'fa': true, 'fa-bolt' : o.isCharging, 'fa-sign-out' : !o.isCharging && !o.isFueling, 'fa-filter': o.isFueling}"></i>
                                </a>
                                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#">
                                    <span class="fa fa-caret-down"></span></a>
                                <ul class="dropdown-menu">
                                    <li><a href="#" data-op="deviceEdit"><i class="fa fa-gears fa-fw"></i> 编辑</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="#" data-op="deviceDetail"><i class="fa fa-navicon fa-fw"></i> 详情</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="#" data-op="showDayStats"><i class="fa fa-line-chart fa-fw"></i> 今日出货统计</a></li>
                                    <li><a href="#" data-op="showMonthStats"><i class="fa fa-area-chart fa-fw"></i> 本月出货统计</a></li>
                                    <li><a href="#" data-op="showAllStats"><i class="fa fa-list-alt fa-fw"></i> 全部出货统计</a></li>
                                    <template v-if="o.isBluetooth">
                                        <li role="separator" class="divider"></li>
                                        <li><a href="#" data-op="showMaintainRec"><i class="fa fa-cogs"></i> 维护记录</a></li>
                                    </template>                                    
                                    <template v-if="!o.isCharging">
                                        <li role="separator" class="divider"></li>
                                        <li><a href="#" data-op="deviceReset" data-params="all"><i class="fa fa-undo fa-fw"></i> 重置全部{{o.isFueling?'枪位':'货道'}}商品数量</a></li>
                                    </template>
                                    <li><a href="#" data-op="deviceConfig"><i class="fa fa-exchange fa-fw"></i> 刷新设备状态和配置</a></li>
                                    <li role="separator" class="divider"></li>
                                    {if \zovye\App::isDeviceScheduleTaskEnabled()}
                                    <li><a href="#" data-op="createScheduleTask"><i class="fa fa-retweet"></i> 创建定时任务</a></li>
                                    <li><a href="#" data-op="getScheduleTaskList"><i class="fa fa-retweet"></i> 查看定时任务</a></li>
                                    <li role="separator" class="divider"></li>
                                    {/if}
                                    <template v-if="o.appId">
                                        <li ><a href="#" data-op="showVersions"><i class="fa fa-cloud-download fa-fw"></i> 推送版本更新</a></li>
                                        <li role="separator" class="divider"></li>
                                        <li><a href="#" data-op="deviceCleanAppId"><i class="fa fa-dot-circle-o fa-fw"></i> 清除已绑定的AppID</a></li>
                                        <li role="separator" class="divider"></li>                                                                  
                                    </template>
                                    <li><a href="#" data-op="deviceRevertPrompt"><i class="fa fa-plug fa-fw"></i> 重置设备</a></li>
                                    <li><a href="#" data-op="deviceRemove"><i class="fa fa-trash fa-fw"></i> 删除</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
    <div class="pull-left operate" style="padding: 0 15px;">
        <i class="fa fa-sort-down" title="显示更多" @click="incrPageSize"></i>
    </div>
    <div class="pull-right" v-if="device.list.length>0">
        <div>
            <ul class="pagination pagination-centered">
                <li v-for="(page, index) in pager" :class="{'active': page.title == device.page}" @click="device.page=page.num()">
                    <a href="#">{{page.title}}</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="text-center text-muted" v-if="device.list.length == 0">
        <i class="fa fa-question-circle"></i> 暂时没有任何设备！
    </div>
    </div>
    </div>
</div>
<script>
    const vuejsUrl = "{php \zovye\url(false, JS_VUE_URL);}";
    const echartsUrl = "{php \zovye\url(false, JS_ECHARTS_URL);}";
    const config = {
        deviceApiUrl: "{php echo $this->createWebUrl('device');}",
        agentApiUrl: "{php echo $this->createWebUrl('agent');}",
        deviceTypesApiUrl: "{php echo $this->createWebUrl('devicetypes');}",
        tagsApiUrl: "{php echo $this->createWebUrl('tags');}",
        upgradeApiUrl: "{php echo $this->createWebUrl('upgrade');}",
        orderApiUrl: "{php echo $this->createWebUrl('order');}",
        deviceDetailUrl: '{php echo $this->createWebUrl("device", array("op"=>"detail", "id" => "__id__"));}',
        page: {php echo intval($page);}
    }
    const current = {
        agent: JSON.parse(decodeURIComponent('{php echo urlencode(json_encode($s_agent ?: []))}')),
        group: JSON.parse(decodeURIComponent('{php echo json_encode($s_group ?: [])}')),
        deviceTypes: JSON.parse(decodeURIComponent('{php echo json_encode($s_device_type ?: [])}')),
        tags: JSON.parse(decodeURIComponent('{php echo json_encode($s_tags ?: [])}')),
    }
</script>
<script src="{php echo MODULE_URL}static/js/device.min.js?v=20220903003"></script>
{template 'common/footer'}