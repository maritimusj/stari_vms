{template 'common/header'}
{php \zovye\url(true, 'static/css/common.css?v=20201108');}
<style>
#list img {
    width: 60px;
    height: 60px;
}
table th,table td {
        text-align: center;
}
</style>
<ul class="nav nav-tabs" id="navbar">
    <li role="presentation" class="active"><a href="#">{$title}</a></li>
</ul>
<div class="panel panel-default panel-first">
    <div class="heading">
        <span class="operate">
            <a href="{php echo $this->createWebUrl('inventory', ['op' => 'stockIn', 'user' => $user, 'id' => $id])}"><i class="fa fa-sign-in" title="入库"></i></a>       
            <a href="{php echo $this->createWebUrl('inventory', ['op' => 'stockLog', 'user' => $user, 'id' => $id])}"><i class="fa fa-reorder" title="出库入库记录"></i></a>
        </span>
    </div>
    <div class="panel-body">
        {if $list}
        <table class="table table-bordered" id="list">
            <thead>
                <th>#</th>
                <th>商品图片</th>
                <th>商品名称</th>
                <th>当前库存数量</th>
            </thead>
            <tbody>
                {loop $list $index $item}
                <tr>
                    <td>
                        {php echo $index+1}
                    </td>
                    <td>
                        <img src=" {$item['goods']['img']}">
                    </td>
                    <td>
                        {$item['goods']['name']}
                    </td>
                    <td>
                        {$item['num']}
                    </td>
                </tr>
                {/loop}
            </tbody>
        </table>
        <div class="pull-right">
            {$pager}
        </div>
        {else}
        <div class="text-center text-muted">
            暂时还没有任何商品！
        </div>
        {/if}
    </div>
</div>
<script>
    const api = {
        goodsApiUrl: "{php echo $this->createWebUrl('goods');}",
        url: "{php echo $this->createWebUrl('inventory', ['id' => $id]);}",
        dlg: null,
    }

    api.showResult = function(params, url, loading, cb) {
        loading && util.loading();
        $.getJSON(url || api.url, params).done(function(res){
            loading && util.loaded();
            if (res) {
                if (typeof cb == 'function') {
                    if(cb(res)) {
                        return;
                    }
                }
                if (res.status) {
                    if (res.data && res.data.content) {
                        api.dlg = util.dialog(res.data.title || '', res.data.content);
                        api.dlg.modal('show');
                    }
                }
                if (res.message && res.type) {
                    util.message(res.message, '', res.type);
                }
                if (res.data && res.data.msg) {
                    util.message(res.data.msg, '', res.status ? 'success' : 'error');
                }
            }
        }).fail(function(){
            loading && util.loaded();
        })
    }
    
    api.hide = function () {
        if (api.dlg) {
            api.dlg.modal('hide');
        }
    }

    api.chooseGoods = function() {
        api.showResult({op: 'goods', pagesize: 10}, goodsApiUrl);
    }

    $(function() {
        $("body").on("click", "[data-op]", function (e) {
            e.preventDefault();
            const op = $(this).data('op');
            if (op && api[op]) {
                api[op](e);
            }
        })
    })
</script>

{template 'common/footer'}